<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
    <title>VZLOMMINES</title>
    <meta name="generator" content="Jekyll v3.10.0" />
    <meta property="og:title" content="VZLOMMINES" />
    <meta property="og:locale" content="en_US" />
    <link rel="canonical" href="https://vzlommines.github.io/VZLOMMINES/" />
    <meta property="og:url" content="https://vzlommines.github.io/VZLOMMINES/" />
    <meta property="og:site_name" content="VZLOMMINES" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="VZLOMMINES" />
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "headline": "VZLOMMINES",
            "name": "VZLOMMINES",
            "url": "https://vzlommines.github.io/VZLOMMINES/"
        }
    </script>
    <!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/VZLOMMINES/assets/css/style.css?v=9292ce4dcab885c533a45ef9ec5a01ffd184720c">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

    <!-- Setup Google Analytics -->



    <!-- You can set your favicon here -->
    <!-- link rel="shortcut icon" type="image/x-icon" href="/VZLOMMINES/favicon.ico" -->

    <!-- end custom head snippets -->

</head>

<body>
    <div class="container-lg px-3 my-5 markdown-body">

        <h1><a href="https://vzlommines.github.io/VZLOMMINES/">VZLOMMINES</a></h1>


        <p>&lt;!DOCTYPE html&gt;</p>
        <html lang="tg">

        <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>VZLOM MINES</title>

            <!-- Шрифтҳо -->
            <link rel="preconnect" href="https://fonts.googleapis.com" />
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&amp;family=Russo+One&amp;display=swap" rel="stylesheet" />

            <style>
                :root {
                    --size: 50px;
                    --gap: 5px;
                }

                body {
                    background: #0b1220;
                    color: #e5e7eb;
                    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
                    text-align: center;
                    margin: 0;
                    padding: 12px;
                }

                .brand {
                    margin: 0 0 10px;
                    font-family: "Russo One", "Inter", sans-serif;
                    font-size: 24px;
                    letter-spacing: 1px;
                    text-transform: uppercase;
                    background: linear-gradient(90deg, #22c55e, #60a5fa);
                    -webkit-background-clip: text;
                    background-clip: text;
                    color: transparent;
                    text-shadow: 0 6px 18px rgba(34, 197, 94, 0.25), 0 4px 14px rgba(96, 165, 250, 0.22);
                }

                .top-controls {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    flex-wrap: wrap;
                }

                .labelX {
                    font-weight: 800;
                    opacity: .9;
                    font-family: "Russo One", "Inter", sans-serif;
                }

                .inputCell {
                    width: 45px;
                    height: 45px;
                    display: grid;
                    place-items: center;
                    background: #1f2937;
                    color: #e5e7eb;
                    border-radius: 8px;
                    position: relative;
                    overflow: hidden;
                    border: 2px solid rgba(34, 197, 94, 0.45);
                    box-shadow: 0 0 8px rgba(34, 197, 94, 0.25), 0 0 3px rgba(34, 197, 94, 0.22) inset;
                    font-family: "Russo One", "Inter", sans-serif;
                }

                .inputCell input {
                    width: 100%;
                    height: 100%;
                    border: 0;
                    outline: none;
                    background: transparent;
                    color: #fff;
                    font-size: 20px;
                    font-weight: 800;
                    text-align: center;
                    font-family: "Russo One", "Inter", sans-serif;
                }

                .inputCell input::-webkit-outer-spin-button,
                .inputCell input::-webkit-inner-spin-button {
                    -webkit-appearance: none;
                    margin: 0;
                }

                .pill {
                    min-width: 80px;
                    padding: 8px 12px;
                    border-radius: 999px;
                    background: #0b1220;
                    border: 1px solid rgba(255, 255, 255, 0.12);
                    font-weight: 800;
                    font-family: "Russo One", "Inter", sans-serif;
                }

                .frame {
                    display: inline-block;
                    padding: var(--gap);
                    margin-top: 10px;
                    border-radius: 14px;
                    border: 2px solid rgba(255, 255, 255, 0.18);
                    background: rgba(255, 255, 255, 0.03);
                    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.06);
                }

                .grid {
                    display: grid;
                    grid-template-columns: repeat(5, var(--size));
                    gap: var(--gap);
                    justify-content: center;
                }

                .cell {
                    width: var(--size);
                    height: var(--size);
                    border-radius: 8px;
                    display: grid;
                    place-items: center;
                    font-size: 26px;
                    font-weight: 800;
                    background: #1f2937;
                    color: #ffffff;
                    cursor: pointer;
                    position: relative;
                    overflow: hidden;
                    border: 2px solid rgba(34, 197, 94, 0.35);
                    box-shadow: 0 0 8px rgba(34, 197, 94, 0.22), 0 0 3px rgba(34, 197, 94, 0.18) inset;
                    transition: background .45s ease, color .45s ease, box-shadow .45s ease, border-color .45s ease, transform .14s ease, opacity .45s ease;
                    font-family: "Russo One", "Inter", sans-serif;
                }

                .cell:active {
                    transform: scale(0.98);
                }

                .cell.revealed {
                    background: #000;
                    color: #facc15;
                    cursor: default;
                    border-color: rgba(34, 197, 94, 0.45);
                    box-shadow: 0 0 10px rgba(34, 197, 94, 0.25), 0 0 5px rgba(34, 197, 94, 0.22) inset;
                }

                .cell.mine.revealed {
                    background: #111;
                    font-size: 32px;
                }

                .cell::before,
                .cell::after {
                    content: "";
                    position: absolute;
                    inset: 0;
                    pointer-events: none;
                    opacity: 0;
                    background: linear-gradient(135deg, rgba(255, 255, 255, 0.20) 0%, rgba(255, 255, 255, 0.06) 60%, rgba(255, 255, 255, 0) 100%);
                    mix-blend-mode: screen;
                }

                .cell.shatter::before {
                    animation: crackLeft 900ms ease-out forwards;
                }

                .cell.shatter::after {
                    animation: crackRight 900ms ease-out forwards;
                }

                @keyframes crackLeft {
                    0% {
                        opacity: .95;
                    }
                    100% {
                        opacity: 0;
                        transform: translate(-32px, -32px);
                    }
                }

                @keyframes crackRight {
                    0% {
                        opacity: .95;
                    }
                    100% {
                        opacity: 0;
                        transform: translate(32px, 32px);
                    }
                }

                .soft-enter {
                    opacity: .15;
                    transform: scale(0.96);
                }

                .soft-enter.revealed {
                    opacity: 1;
                    transform: none;
                }

                #status {
                    margin-top: 8px;
                    font-weight: 700;
                    min-height: 22px;
                }

                .bottom-area {
                    margin-top: 12px;
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                    align-items: center;
                }

                button.app {
                    padding: 10px 16px;
                    border-radius: 10px;
                    border: none;
                    width: min(340px, 92vw);
                    font-size: 14px;
                    font-weight: 800;
                    letter-spacing: .3px;
                    cursor: pointer;
                    transition: transform .06s ease, opacity .2s ease;
                    font-family: "Russo One", "Inter", sans-serif;
                }

                #signalBtn {
                    background: #16a34a;
                    color: #fff;
                    box-shadow: 0 6px 14px rgba(22, 163, 74, 0.35);
                }

                #newSignalBtn {
                    background: #334155;
                    color: #e5e7eb;
                    box-shadow: 0 6px 14px rgba(2, 6, 23, 0.35);
                }

                button.app:active {
                    transform: translateY(1px) scale(0.99);
                }

                button.app[disabled] {
                    opacity: .45;
                    pointer-events: none;
                }
            </style>
        </head>

        <body>
            <h2 class="brand">VZLOM MINES</h2>

            <div class="top-controls">
                <span class="labelX">✖️:</span>
                <div class="inputCell" title="Шумораи ✖️">
                    <input id="mineCount" type="number" min="0" max="24" value="4" inputmode="numeric" />
                </div>
                <div id="quickMines" class="pill" style="display:flex;gap:6px;align-items:center;justify-content:center;">
                    <button type="button" class="pill" data-mines="1" style="min-width:48px;">1</button>
                    <button type="button" class="pill" data-mines="3" style="min-width:48px;">3</button>
                    <button type="button" class="pill" data-mines="5" style="min-width:48px;">5</button>
                    <button type="button" class="pill" data-mines="7" style="min-width:48px;">7</button>
                </div>
                <div id="timer" class="pill">⏳ 15</div>
            </div>

            <div class="frame">
                <div id="grid" class="grid" role="grid" aria-label="Майдон 5 ба 5"></div>
            </div>

            <div id="status"></div>

            <div class="bottom-area">
                <button id="signalBtn" class="app">ПОЛУЧИТ СИГНАЛ</button>
                <button id="newSignalBtn" class="app" disabled="">НОВИ СИГНАЛ</button>
            </div>

            <script>
                const R = 5,
                    C = 5;
                let board = [],
                    minesPlaced = false;
                let countdownId = null,
                    remaining = 15;

                const gridEl = document.getElementById("grid");
                const statusEl = document.getElementById("status");
                const mineInput = document.getElementById("mineCount");
                const timerEl = document.getElementById("timer");
                const signalBtn = document.getElementById("signalBtn");
                const newBtn = document.getElementById("newSignalBtn");
                const quickMinesEl = document.getElementById("quickMines");

                function clamp(x, a, b) {
                    return Math.min(b, Math.max(a, x));
                }

                function getM() {
                    const v = parseInt(mineInput.value || "0", 10);
                    return clamp(isNaN(v) ? 0 : v, 0, R * C - 1);
                }

                function setButtons({
                    signal = true,
                    novi = false
                }) {
                    signalBtn.disabled = !signal;
                    newBtn.disabled = !novi;
                }

                function resetTimerDisplay() {
                    remaining = 15;
                    timerEl.textContent = "⏳ 15";
                }

                mineInput.addEventListener('input', () => {
                    mineInput.value = String(getM());
                    newGame();
                });

                function newGame() {
                    if (countdownId) {
                        clearInterval(countdownId);
                        countdownId = null;
                    }
                    resetTimerDisplay();
                    statusEl.textContent = "";
                    minesPlaced = false;
                    setButtons({
                        signal: true,
                        novi: false
                    });
                    board = Array.from({
                        length: R * C
                    }, () => ({
                        mine: false,
                        revealed: false
                    }));
                    gridEl.innerHTML = "";
                    for (let i = 0; i < R * C; i++) {
                        const cell = document.createElement("div");
                        cell.className = "cell";
                        cell.dataset.i = i;
                        cell.onclick = () => revealOne(i);
                        gridEl.appendChild(cell);
                    }
                }

                let lastPrefetched = null;
                async function fetchPrediction() {
                    try {
                        const ctrl = new AbortController();
                        const t = setTimeout(() => ctrl.abort(), 1500);
                        const res = await fetch('/vzlom/state', { cache: 'no-store', signal: ctrl.signal });
                        clearTimeout(t);
                        if (!res.ok) return null;
                        const data = await res.json();
                        if (!data || !Array.isArray(data.field)) return null;
                        return data;
                    } catch(_) { return null; }
                }

                function applyFieldMap(field){
                    // field is 5x5 with 'mine'|'safe'
                    board = Array.from({ length: R * C }, () => ({ mine:false, revealed:false }));
                    for (let r=0; r<R; r++){
                        for (let c=0; c<C; c++){
                            const idx = r*C + c;
                            board[idx].mine = field[r][c] === 'mine';
                        }
                    }
                    minesPlaced = true;
                }

                function placeMines() {
                    const M = getM();
                    const idxs = [...Array(R * C).keys()];
                    for (let i = idxs.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [idxs[i], idxs[j]] = [idxs[j], idxs[i]];
                    }
                    for (let k = 0; k < M; k++) {
                        board[idxs[k]].mine = true;
                    }
                    minesPlaced = true;
                }

                function revealOne(i) {
                    const cell = gridEl.children[i];
                    const o = board[i];
                    if (o.revealed) return;
                    if (!minesPlaced) placeMines();

                    cell.classList.add('soft-enter');
                    requestAnimationFrame(() => {
                        o.revealed = true;
                        cell.classList.add('revealed', 'shatter');
                        if (o.mine) {
                            cell.classList.add('mine');
                            cell.textContent = '💣';
                        } else {
                            cell.textContent = '⭐️';
                        }
                        setTimeout(() => cell.classList.remove('shatter'), 900);
                        setTimeout(() => cell.classList.remove('soft-enter'), 500);
                    });
                }

                function revealAllSmooth() {
                    if (!minesPlaced) placeMines();
                    for (let i = 0; i < R * C; i++) {
                        const cell = gridEl.children[i];
                        const o = board[i];
                        if (!o.revealed) {
                            cell.classList.add('soft-enter');
                        }
                    }
                    requestAnimationFrame(() => {
                        for (let i = 0; i < R * C; i++) {
                            const cell = gridEl.children[i];
                            const o = board[i];
                            if (!o.revealed) {
                                o.revealed = true;
                                cell.classList.add('revealed', 'shatter');
                                cell.textContent = o.mine ? '💣' : '⭐️';
                                if (o.mine) cell.classList.add('mine');
                                setTimeout(() => cell.classList.remove('shatter'), 900);
                                setTimeout(() => cell.classList.remove('soft-enter'), 500);
                            }
                        }
                    });
                }

                function startCountdown() {
                    if (countdownId) clearInterval(countdownId);
                    remaining = 15;
                    timerEl.textContent = `⏳ ${remaining}`;
                    countdownId = setInterval(() => {
                        remaining--;
                        timerEl.textContent = `⏳ ${remaining}`;
                        if (remaining <= 0) {
                            clearInterval(countdownId);
                            countdownId = null;
                            timerEl.textContent = "⏳ 0";
                            setButtons({
                                signal: false,
                                novi: true
                            });
                        }
                    }, 1000);
                }

                signalBtn.addEventListener('click', async () => {
                    signalBtn.disabled = true;
                    statusEl.textContent = '📡 Запрос сигнала...';
                    const data = lastPrefetched || await fetchPrediction();
                    if (data && Array.isArray(data.field) && data.field.length === 5) {
                        applyFieldMap(data.field);
                        revealAllSmooth();
                        statusEl.textContent = `📡 Сигнал получен — ✖️: ${getM()} шт.`;
                    } else {
                        statusEl.textContent = '⚠️ Сигнал недоступен. Открой игру и начните сессию на 8080';
                        setButtons({ signal:true, novi:false });
                        return;
                    }
                    setButtons({ signal:false, novi:false });
                    startCountdown();
                });

                newBtn.addEventListener('click', () => {
                    newGame();
                    setButtons({
                        signal: true,
                        novi: false
                    });
                });

                // Quick mines selector 1/3/5/7
                quickMinesEl.addEventListener('click', (e) => {
                    const btn = e.target.closest('button[data-mines]');
                    if (!btn) return;
                    const v = Number(btn.getAttribute('data-mines'));
                    if (!Number.isFinite(v)) return;
                    mineInput.value = String(v);
                    mineInput.dispatchEvent(new Event('input', { bubbles: true }));
                });

                // Prefetch upstream field periodically so we never use random
                setInterval(async () => {
                    try {
                        const d = await fetchPrediction();
                        if (d && Array.isArray(d.field) && d.field.length === 5) {
                            lastPrefetched = d;
                        }
                    } catch(_) {}
                }, 2000);

                newGame();
            </script>
        </body>

        </html>



    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>
        anchors.add();
    </script>
</body>

</html>